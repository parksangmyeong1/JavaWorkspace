<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	 
<!-- 인터페이스의 full name을 namespace로 설정 -->
<mapper namespace="com.bitcamp.cobsp.post.dao.Dao">
	
	<!-- select의 결과를 매핑하는 설정 -->
	<resultMap id="postListResult" 
		type="com.bitcamp.cobsp.post.domain.Post">
		<id column="postIdx" property="postIdx"/>
		<result column="memIdx" property="memIdx"/>
		<result column="postWriter" property="postWriter"/>
		<result column="postSort" property="postSort"/>
		<result column="postContent" property="postContent"/>
		<result column="postRegDate" property="postRegDate"/>
		<result column="views" property="views"/>
		<result column="postLike" property="postLike"/>
		<result column="postDislike" property="postDislike"/>
		<result column="postRep" property="postRep"/>
	</resultMap>
	
	<resultMap id="commListResult" 
		type="com.bitcamp.cobsp.comment.domain.Comment">
		<id column="commIdx" property="commIdx"/>
		<result column="postIdx" property="postIdx"/>
		<result column="commContent" property="commContent"/>
		<result column="commRegDate" property="commRegDate"/>
		<result column="commLike" property="commLike"/>
		<result column="commDislike" property="commDislike"/>
		<result column="commRep" property="commRep"/>
	</resultMap>
	
	<!-- 게시글 등록 -->
	<insert id="insertPost"
		parameterType="com.bitcamp.cobsp.post.domain.Post"
		useGeneratedKeys="true"
		keyProperty="postIdx">
		insert into post (memIdx, postWriter, postTitle, postContent, postSort)
		value (#{memIdx}, #{postWriter}, #{postTitle}, #{postContent}, #{postSort})
	</insert>
	
	<!-- 게시글 리스트 출력 -->
	<select id="selectAll"
		resultMap="postListResult">
		select * from post order by postIdx desc
	</select>
	
	<!-- 게시글 수정 -->
	<update id="editPost"
		parameterType="com.bitcamp.cobsp.post.domain.Post">
		update post set postSort = #{postSort}, postTitle = #{postTitle}, postContent = #{postContent} where postIdx = #{postIdx}
	</update>
	
	<!-- 게시글 삭제 -->
	<delete id="deletePost">
		delete from post where postIdx = #{postIdx}
	</delete>
	
	<!-- 해당 게시글 출력 -->
	<select id="selectPostDetail" resultMap="postListResult">
	<![CDATA[
		select * from post where postIdx IN (
          ( SELECT postIdx FROM post WHERE postIdx < #{postIdx} ORDER BY postIdx DESC LIMIT 1 ),
          ( SELECT postIdx FROM post WHERE postIdx = #{postIdx} ),
          ( SELECT postIdx FROM post WHERE postIdx > #{postIdx} ORDER BY postIdx LIMIT 1)
       )
       ]]>
	</select>
	
	<!-- 수정할 게시글 가져오기 -->
	<select id="selectByIdx" resultMap="postListResult"> 
		select * from post where postIdx = #{postIdx}
	</select>
	
	<!-- 댓글 등록 -->
	<insert id="insertComment"
		parameterType="com.bitcamp.cobsp.comment.domain.Comment"
		useGeneratedKeys="true"
		keyProperty="commIdx">
		insert into comment (postIdx, commContent)
		value (#{postIdx}, #{commContent})
	</insert>	
	
	<!-- 댓글 조회 -->
	<select id="selectCommList"
		resultMap="commListResult">
		select * from comment where postIdx = #{postIdx}
	</select>
</mapper>